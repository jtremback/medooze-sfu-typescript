<p>
  <b>Delay:&nbsp;</b>
  <span id="delay" style="display:inline-block;width:20px;text-align:right">??</span>
  <span>ms&nbsp;</span>
  <button type="button" onclick="ping()">Ping</button>
</p>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.slim.js"></script>
<script>
  const url = '/';
  const socket = io(url, { path: '/node/socket.io' }); // important!

  window.onload = () =>{
    const ws = setupConnection('ws://localhost/sfu');
  };

  socket
    .on('connect', msg => {
      console.log('connected');
    })
    .on('io-pong', msg => {
      console.log(msg);
      const delay = Date.now() - parseInt(msg);
      document.querySelector('#delay').innerHTML = delay;
    })

  function ping() {
    socket.emit('io-ping', Date.now())
  }

  const setupConnection = async () => {
    try {
        _ws = await setupWs('ws://localhost/sfu');

        _peer = prepareNewConnection(true, _stream);
        makeOfferAsync(_peer);
    } catch (e) {
        console.log(e);
    }
};

const setupWs = (url) => {

    console.log("ws url:", url);
    return new Promise((resolve, reject) => {
        let ws = new WebSocket(url);

        ws.onmessage = (ev) => {
            let data = ev.data;
            let message = JSON.parse(data);
            switch (message.type) {
                case 'answer':
                    setAnswerAsync(message.sdp, _peer);
                    break;
                case 'update':
                    updateSDPAsync(message.sdp, _peer);
                    break;
            }
        };

        ws.onopen = () => {
            resolve(ws);
        };

        ws.onerror = (e) => {
            reject(e);
        }
    });
};
</script>